import React, { useEffect, useRef } from "react";
import gsap from "gsap";
import topImg from "@/assets/images/top_img_loader.png";
import bottomImg from "@/assets/images/bottom_img_loader.png";
import word from "@/assets/images/word.png";

const Loader = ({ onFinish }) => {
    const svgRef = useRef(null);
    const wordRef = useRef(null);
    const topRef = useRef(null);
    const bottomRef = useRef(null);

    useEffect(() => {
        if (!svgRef.current || !wordRef.current) return;

        const logoPaths = svgRef.current.querySelectorAll("path");
        const wordPaths = wordRef.current.querySelectorAll("path");



        const tl = gsap.timeline(
            {
                onComplete: () => {
                    if (onFinish) onFinish();
                }
            }
        );

        // 1)  DRAW LOGO PATHS
        logoPaths.forEach((p, i) => {
            const length = p.getTotalLength();
            gsap.set(p, {
                strokeDasharray: length,
                strokeDashoffset: length,
                stroke: "#d3b222",
                strokeWidth: 10,
                fill: "none"
            });

            tl.to(
                p,
                {
                    strokeDashoffset: 0,
                    duration: 1.2,
                    ease: "power2.inOut"
                },
                i * 0.15 // small staggering between paths
            );
        });


        wordPaths.forEach((p, i) => {
            const length = p.getTotalLength();
            gsap.set(p, {
                strokeDasharray: length,
                strokeDashoffset: length,
                stroke: "#000000",
                strokeWidth: 10,
                fill: "none",
            });

            tl.to(
                p,
                { strokeDashoffset: 0, duration: 1.2, ease: "power2.inOut", delay: 1 },
                i * 0.15
            );
        });

        gsap.to(wordRef.current, { opacity: 1, duration: 0.2, delay: 0.2 });


        tl.to([wordRef.current, svgRef.current], {
            opacity: 0,
            duration: 0.4,
            ease: "power1.out"
        });



        tl.to([topRef.current, bottomRef.current], {
            opacity: 1,
            duration: 0.4,
            ease: "power2.out"
        });

        
        tl.to(
            topRef.current,
            {
                y: "-100%",
                duration: 1.2,
                ease: "power3.inOut"
            },
            "-=0.1"
        );

        tl.to(
            bottomRef.current,
            {
                y: "100%",
                duration: 1.2,
                ease: "power3.inOut"
            },
            "<"
        );
    }, []);

    return (
        <div className="fixed inset-0 flex flex-col bg-[#ffffff] z-9999 overflow-hidden">


            <div className="absolute inset-0 flex flex-col items-center justify-center z-50">
                {/* SVG DRAWING */}
                <div
                    className="flex items-center justify-center z-50 absolute"
                    ref={svgRef}
                >
                    <svg
                        width="420"
                        height="420"
                        viewBox="0 0 300 324"
                        xmlns="http://www.w3.org/2000/svg"
                    >
                        <g transform="translate(0,324) scale(0.1,-0.1)" fill="none">
                            <path d="M1362 2290 c-75 -20 -172 -66 -172 -82 0 -5 10 -2 23 6 49 32 151 67 222 77 164 22 350 -45 466 -169 35 -37 76 -91 92 -119 34 -63 67 -189 67 -254 0 -75 -36 -225 -61 -255 -6 -8 -6 -14 -1 -18 6 -3 17 11 25 33 67 167 62 332 -15 491 -39 82 -160 205 -238 243 -132 65 -278 82 -408 47z" />
                            <path d="M1010 2170 c-11 -7 -6 -10 21 -10 20 0 46 -8 58 -17 l21 -18 -40 -95 c-22 -52 -53 -124 -69 -160 -17 -41 -36 -70 -52 -77 -22 -12 -19 -13 30 -13 46 0 52 2 41 15 -10 12 -9 25 6 65 l18 51 74 -3 74 -3 23 -62 c12 -35 34 -78 48 -96 22 -30 24 -35 11 -57 -29 -54 -8 -111 51 -136 26 -11 42 -11 86 0 30 7 67 20 82 30 32 21 30 22 46 -23 23 -70 11 -121 -37 -144 -64 -32 -145 -13 -173 40 -7 13 -16 23 -21 23 -16 0 -7 -17 27 -50 68 -66 198 -47 224 33 10 30 3 72 -24 140 -7 16 -4 17 21 11 43 -10 81 -51 117 -124 27 -54 33 -78 35 -150 4 -82 3 -87 -20 -97 -20 -10 -14 -12 42 -12 53 0 61 2 45 11 -33 19 -36 30 -30 97 12 126 69 241 133 268 23 10 32 18 23 21 -21 7 -75 -25 -101 -60 -12 -17 -33 -56 -45 -87 -19 -45 -25 -52 -30 -36 -33 102 -86 167 -144 180 l-31 7 37 45 c58 70 94 103 112 103 9 0 31 -9 49 -20 17 -11 32 -16 32 -11 0 15 -25 31 -59 37 -42 9 -76 -10 -111 -61 -69 -100 -142 -153 -223 -162 -33 -4 -48 0 -69 17 -30 23 -34 45 -16 85 8 18 17 24 27 19 33 -13 91 -17 91 -5 0 6 -13 11 -29 11 -66 0 -113 68 -180 263 -22 63 -49 133 -60 156 -30 59 -99 88 -141 61z m144 -153 c14 -42 26 -80 26 -82 0 -3 -29 -5 -65 -5 l-64 0 28 68 c15 37 31 76 35 86 9 25 10 23 40 -67z" />
                            <path d="M1556 2078 c-30 -27 -66 -95 -66 -123 0 -12 10 1 24 31 22 48 68 104 85 104 4 0 16 -6 26 -14 18 -13 18 -16 5 -41 -8 -15 -41 -52 -74 -82 -53 -49 -61 -53 -67 -37 -7 16 -8 15 -9 -6 0 -18 -15 -35 -47 -60 -98 -73 -114 -90 -102 -112 10 -18 14 -16 72 34 34 29 95 80 135 113 41 32 85 75 98 94 26 38 31 90 12 109 -19 19 -65 14 -92 -10z" />
                            <path d="M1485 1766 c5 -52 24 -130 30 -125 4 5 -23 149 -30 164 -3 6 -3 -12 0 -39z" />
                            <path d="M926 1713 c-9 -9 -7 -73 2 -73 5 0 7 15 5 33 -2 27 0 26 12 -13 l15 -45 -5 40 c-3 28 -2 35 5 25 5 -8 10 -27 10 -41 0 -33 38 -111 50 -104 13 8 13 -15 0 -35 -12 -20 -20 -10 -41 52 -10 29 -20 52 -23 51 -16 -8 -25 -1 -20 15 4 11 3 13 -3 5 -7 -9 -18 -5 -46 18 -33 27 -37 28 -37 11 0 -38 30 -92 61 -107 17 -9 33 -14 36 -12 2 3 -5 8 -16 12 -25 8 -61 52 -61 74 1 12 5 11 20 -8 11 -13 20 -18 20 -12 0 7 5 9 11 6 6 -4 8 -9 5 -12 -3 -3 13 -28 35 -55 21 -27 40 -54 40 -59 1 -5 2 -15 3 -21 1 -7 -5 -16 -14 -20 -10 -4 -7 -7 11 -7 28 -1 64 -31 38 -31 -11 0 -11 -2 1 -10 25 -16 29 -12 23 24 -3 19 -1 36 6 40 14 9 15 26 1 26 -5 0 -13 -15 -18 -32 -8 -28 -11 -30 -17 -14 -5 10 -3 34 4 53 9 25 10 38 2 46 -7 7 -4 17 9 35 25 32 27 65 3 60 -11 -2 -17 -11 -15 -22 2 -12 -1 -16 -9 -10 -8 4 -10 3 -5 -5 4 -6 12 -9 17 -6 15 10 10 -11 -5 -24 -10 -8 -16 -9 -21 -1 -3 5 -3 10 0 10 4 0 -3 13 -14 29 -12 16 -21 36 -21 45 0 38 -37 85 -54 69z" />
                            <path d="M890 1501 c0 -22 40 -63 64 -67 9 -1 14 2 10 7 -3 5 -11 9 -18 9 -13 0 -46 31 -46 44 0 3 11 -1 25 -10 14 -9 32 -14 40 -10 8 3 15 1 15 -4 0 -6 5 -10 12 -10 6 0 3 9 -7 20 -10 11 -23 20 -29 20 -6 0 -4 -5 4 -10 13 -9 13 -10 0 -10 -8 0 -22 5 -30 10 -13 9 -13 10 0 11 10 0 8 3 -5 9 -30 13 -35 12 -35 -9z" />
                            <path d="M1086 1438 c-8 -33 -6 -46 4 -23 7 17 9 14 9 -13 1 -20 -3 -31 -9 -27 -19 12 -31 -6 -15 -21 17 -17 20 -50 5 -59 -11 -7 -2 -35 12 -35 5 0 16 -7 24 -15 18 -18 65 -20 82 -3 9 9 21 7 51 -10 85 -48 283 -78 346 -53 12 5 -28 10 -105 13 -108 4 -134 8 -193 32 -58 24 -69 33 -74 57 -3 16 -9 29 -14 29 -5 0 -9 8 -10 18 -1 11 -4 9 -10 -8 -7 -22 -8 -21 -6 10 1 19 -2 36 -8 37 -5 2 -10 -13 -10 -31 l0 -34 -27 20 c-24 17 -27 25 -24 66 3 50 -1 72 -14 72 -4 0 -10 -10 -14 -22z m45 -125 c12 -14 12 -16 0 -9 -9 6 -12 5 -9 -5 2 -7 15 -14 29 -14 15 0 24 -6 24 -15 0 -8 5 -18 10 -22 6 -4 -3 -8 -19 -8 -21 0 -27 4 -22 15 5 15 -4 19 -38 15 -14 -1 -17 3 -12 15 3 9 6 23 6 31 0 19 15 18 31 -3z" />
                            <path d="M935 1371 c-6 -12 40 -49 70 -57 13 -3 36 -4 51 -1 23 3 21 4 -11 6 -40 1 -85 23 -85 41 0 5 19 11 43 13 41 3 40 4 -10 5 -28 1 -54 -2 -58 -7z" />
                        </g>
                    </svg>
                </div>

                <div ref={wordRef} className="flex items-center justify-center w-96 sm:w-auto z-50 absolute lg:top-100 top-50 lg:translate-y-0 translate-y-full" style={{ opacity: 0 }}>
                    <svg width="520" height="160" viewBox="0 0 300 88">
                        <g transform="translate(0,88) scale(0.1,-0.1)" fill="none" stroke="none">
                            <path d="M2421 838 c-10 -24 -26 -66 -35 -95 l-17 -51 -92 -6 c-51 -4 -107 -5 -126 -4 -22 2 -36 -2 -39 -11 -4 -11 17 -12 122 -6 l127 7 -26 -57 c-49 -113 -88 -158 -113 -133 -7 7 -12 18 -12 24 0 22 -21 27 -36 8 -14 -17 -15 -16 -9 19 10 62 -4 60 -48 -5 -46 -68 -80 -86 -92 -48 -5 15 -1 25 10 34 18 13 18 49 0 50 -5 1 -18 -14 -27 -33 -19 -38 -62 -71 -94 -71 -32 0 -71 36 -84 78 -7 20 -16 41 -20 45 -4 5 -26 -8 -49 -28 l-41 -37 5 28 c3 16 1 36 -5 44 -9 12 -19 6 -60 -40 l-50 -55 20 53 c22 58 25 88 10 97 -12 7 -52 -34 -122 -125 -58 -76 -89 -98 -109 -74 -10 12 -10 19 -1 32 33 46 46 82 34 94 -17 17 -43 0 -61 -38 -25 -52 -61 -83 -61 -51 0 7 -6 22 -14 32 -13 18 -16 16 -65 -25 -28 -24 -54 -41 -57 -37 -12 11 29 57 62 69 35 12 42 22 24 33 -11 7 -52 -16 -79 -42 -22 -23 -89 -53 -115 -53 -28 0 -58 34 -49 56 10 26 -41 15 -77 -16 -39 -32 -50 -36 -50 -17 0 14 -52 77 -63 77 -4 0 -29 -20 -57 -45 -28 -25 -55 -45 -61 -45 -5 0 -16 15 -24 34 -20 48 -30 51 -55 13 l-21 -32 6 52 c12 96 -12 90 -86 -23 -23 -35 -48 -64 -55 -64 -24 0 -28 30 -7 53 27 30 34 52 20 66 -8 8 -17 5 -34 -11 -41 -39 -24 -135 23 -127 10 2 38 33 61 68 59 89 61 90 51 25 -15 -94 3 -111 41 -38 l24 45 14 -33 c16 -38 31 -50 56 -42 9 3 17 1 17 -5 0 -21 34 -10 76 25 l44 35 10 -26 c5 -14 10 -29 10 -32 0 -3 -26 -34 -59 -69 -79 -87 -122 -170 -129 -249 -4 -54 -2 -65 17 -84 48 -48 135 -10 184 83 18 35 22 57 22 151 0 61 -4 125 -8 143 -6 21 -5 32 2 32 6 0 11 -7 11 -15 0 -21 14 -19 48 10 29 24 29 24 47 5 23 -25 60 -25 108 -1 36 18 37 18 37 0 0 -29 28 -23 76 17 l44 35 10 -26 c5 -14 10 -29 10 -32 0 -3 -26 -33 -57 -67 -79 -84 -124 -171 -131 -251 -4 -54 -2 -65 17 -84 48 -48 135 -9 183 83 26 49 37 207 19 271 -9 32 -8 42 6 57 22 24 27 23 40 -12 8 -21 18 -30 33 -30 35 0 55 16 108 88 28 37 60 76 71 86 l20 18 -20 -51 c-19 -51 -25 -102 -13 -114 4 -3 26 21 51 54 25 32 48 59 52 59 4 0 5 -15 3 -34 -6 -50 11 -51 58 -3 l43 42 17 -40 c10 -22 27 -49 39 -60 30 -27 91 -26 129 2 l28 21 10 -22 c16 -36 53 -27 91 22 l33 44 0 -36 c0 -40 13 -46 32 -16 12 19 13 19 34 -8 l22 -27 29 20 c22 16 92 134 114 192 2 6 13 13 24 17 20 6 20 2 17 -219 -3 -184 -1 -225 10 -225 11 0 12 40 10 216 -2 119 1 220 5 225 4 4 104 11 221 15 116 4 212 11 212 15 0 10 -214 10 -343 1 l-88 -7 6 65 c3 36 8 75 11 87 8 41 -16 35 -35 -9z m14 -40 c-14 -103 -16 -108 -35 -108 -17 0 -17 5 8 75 15 41 28 75 30 75 1 0 0 -19 -3 -42z m-1615 -308 c-44 -39 -60 -48 -60 -32 1 22 64 72 90 72 9 -1 -4 -17 -30 -40z m163 -12 c-18 -18 -36 -28 -40 -24 -9 9 42 56 60 56 6 0 -3 -14 -20 -32z m-79 -79 c11 -54 6 -192 -8 -232 -21 -56 -62 -104 -102 -117 -33 -11 -38 -10 -58 9 -50 51 -9 184 97 309 29 33 55 61 58 61 4 1 9 -13 13 -30z m422 -15 c12 -79 0 -205 -24 -251 -40 -77 -108 -112 -145 -74 -50 50 -7 186 98 311 28 32 53 59 57 59 4 1 10 -20 14 -45z" />
                        </g>
                    </svg>
                </div>
            </div>

            {/* TOP IMAGE */}
            <div
                ref={topRef}
                className="flex-1 flex items-end justify-center bg-[#faf7ef] opacity-0"
            >
                <img
                    src={topImg}
                    className="w-[420px] object-contain pointer-events-none"
                />
            </div>

            {/* BOTTOM IMAGE */}
            <div
                ref={bottomRef}
                className="flex-1 flex items-start justify-center bg-[#faf7ef] opacity-0"
            >
                <div className="flex flex-col items-center">
                    <img
                        src={bottomImg}
                        className="w-[420px] object-contain pointer-events-none"
                    />
                    <img
                        src={word}
                        className="w-[420px] object-contain pointer-events-none absolute translate-y-1/2"
                    />
                </div>
            </div>
        </div>
    );
};

export default Loader;
